package com.jsp.employee_servlet_project.controller;

import java.io.IOException;
import java.io.PrintWriter;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import javax.servlet.GenericServlet;
import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebServlet;

import com.jsp.employee_servlet_project.dao.DatabaseConnection;
import com.jsp.employee_servlet_project.dao.EmployeeCrud;
import com.jsp.employee_servlet_project.dto.Employee;

@WebServlet("/login")
public class Login extends GenericServlet {

	@Override
	public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException {
		String email = req.getParameter("email");
		String password = req.getParameter("password");
		EmployeeCrud crud = new EmployeeCrud();
		try {
			Employee emp = crud.fetchEmployee(email);
			System.out.println(emp);
			if(emp != null) {
				if(emp.getPwd().equals(password)) {
					System.out.println("login succcess");
				}else {
					System.out.println("login failed --pwd no matched");
				}
			}else {
				//System.out.println("email wrong");
				RequestDispatcher dispatcher = req.getRequestDispatcher("login.html");
				dispatcher.include(req, res);
			}
		} catch(Exception e) {
			
		}
		
//		if(crud.login(email)) {
//			Employee emp = crud.fetchEmployee(password);
			
//			Connection con = DatabaseConnection.getConnection();
//			try {
//				PreparedStatement ps = con.prepareStatement("select * from employee where password = ?");
//				ps.setString(1, password);
//				ResultSet res1 = ps.executeQuery();
//				if(res1.next()) {
//					//System.out.println(res1.getString(1));
//					PrintWriter writer = res.getWriter();
//					writer.println(res1.getString(1));
//				}
//			}catch (Exception e) {
//				RequestDispatcher dispatcher = req.getRequestDispatcher("register.html");
//				dispatcher.include(req, res);
//			}
			
		}
//		PrintWriter writer = res.getWriter();
//		writer.println("saved successfully");
	}
